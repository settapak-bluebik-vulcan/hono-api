<!--
  A.E.G.I.S. - Automated Engine for Generative Interaction Systems

  UI:      Generated by AI (Claude)
  Backend: Settapak Thongyou
-->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>A.E.G.I.S. - AI Chat</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #1a1a2e; color: #eee; height: 100vh; display: flex; }

    /* Sidebar */
    .sidebar {
      width: 280px; background: #16213e; display: flex; flex-direction: column;
      border-right: 1px solid #0f3460;
    }
    .sidebar-header {
      padding: 16px; border-bottom: 1px solid #0f3460;
      display: flex; align-items: center; justify-content: space-between;
    }
    .sidebar-header h2 { font-size: 16px; color: #e94560; }
    .new-chat-btn {
      background: #e94560; color: #fff; border: none; padding: 8px 14px;
      border-radius: 8px; cursor: pointer; font-size: 13px;
    }
    .new-chat-btn:hover { background: #c73450; }
    .conversation-list { flex: 1; overflow-y: auto; padding: 8px; }
    .conversation-item {
      padding: 12px; border-radius: 8px; cursor: pointer; margin-bottom: 4px;
      display: flex; justify-content: space-between; align-items: center;
    }
    .conversation-item:hover { background: #0f3460; }
    .conversation-item.active { background: #0f3460; }
    .conversation-item .title { font-size: 14px; flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .conversation-item .edit-btn {
      background: none; border: none; color: #888; cursor: pointer; font-size: 12px; padding: 4px 8px;
    }
    .conversation-item .edit-btn:hover { color: #e94560; }

    /* Main Chat */
    .main { flex: 1; display: flex; flex-direction: column; }
    .chat-header {
      padding: 16px 24px; border-bottom: 1px solid #0f3460;
      font-size: 16px; font-weight: 600; background: #16213e;
    }
    .messages {
      flex: 1; overflow-y: auto; padding: 24px; display: flex;
      flex-direction: column; gap: 16px;
    }
    .message { max-width: 75%; padding: 12px 16px; border-radius: 12px; line-height: 1.5; font-size: 14px; }
    .message.user { background: #e94560; align-self: flex-end; border-bottom-right-radius: 4px; }
    .message.assistant { background: #0f3460; align-self: flex-start; border-bottom-left-radius: 4px; }

    .empty-state {
      flex: 1; display: flex; align-items: center; justify-content: center;
      color: #555; font-size: 18px; flex-direction: column; gap: 8px;
    }
    .empty-state span { font-size: 48px; }

    /* Input */
    .input-area {
      padding: 16px 24px; border-top: 1px solid #0f3460; background: #16213e;
      display: flex; gap: 12px;
    }
    .input-area input {
      flex: 1; padding: 12px 16px; border-radius: 12px; border: 1px solid #0f3460;
      background: #1a1a2e; color: #eee; font-size: 14px; outline: none;
    }
    .input-area input:focus { border-color: #e94560; }
    .input-area button {
      background: #e94560; color: #fff; border: none; padding: 12px 24px;
      border-radius: 12px; cursor: pointer; font-size: 14px;
    }
    .input-area button:hover { background: #c73450; }
    .input-area button:disabled { background: #555; cursor: not-allowed; }

    /* Rename Modal */
    .modal-overlay {
      display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.6); align-items: center; justify-content: center; z-index: 100;
    }
    .modal-overlay.show { display: flex; }
    .modal {
      background: #16213e; padding: 24px; border-radius: 12px; width: 400px;
      border: 1px solid #0f3460;
    }
    .modal h3 { margin-bottom: 16px; }
    .modal input {
      width: 100%; padding: 10px 14px; border-radius: 8px; border: 1px solid #0f3460;
      background: #1a1a2e; color: #eee; font-size: 14px; margin-bottom: 16px; outline: none;
    }
    .modal-actions { display: flex; gap: 8px; justify-content: flex-end; }
    .modal-actions button {
      padding: 8px 16px; border-radius: 8px; border: none; cursor: pointer; font-size: 13px;
    }
    .btn-cancel { background: #333; color: #eee; }
    .btn-save { background: #e94560; color: #fff; }
  </style>
</head>
<body>

  <!-- Sidebar -->
  <div class="sidebar">
    <div class="sidebar-header">
      <h2>A.E.G.I.S.</h2>
      <button class="new-chat-btn" onclick="createConversation()">+ New</button>
    </div>
    <div class="conversation-list" id="conversationList"></div>
    <div style="padding: 12px 16px; border-top: 1px solid #0f3460; font-size: 11px; color: #ffffff; text-align: center; line-height: 1.6;">
      Backend by Settapak Thongyou<br/>UI by AI (Claude)
    </div>
  </div>

  <!-- Main -->
  <div class="main">
    <div class="chat-header" id="chatHeader">Select a conversation</div>
    <div class="messages" id="messages">
      <div class="empty-state">
        <span>&#x1F916;</span>
        <div>Start a new conversation</div>
      </div>
    </div>
    <div class="input-area">
      <input type="text" id="messageInput" placeholder="Type a message..." onkeydown="if(event.key==='Enter')sendMessage()" />
      <button onclick="sendMessage()" id="sendBtn">Send</button>
    </div>
  </div>

  <!-- Rename Modal -->
  <div class="modal-overlay" id="renameModal">
    <div class="modal">
      <h3>Rename Conversation</h3>
      <input type="text" id="renameInput" placeholder="New title..." onkeydown="if(event.key==='Enter')saveRename()" />
      <div class="modal-actions">
        <button class="btn-cancel" onclick="closeRename()">Cancel</button>
        <button class="btn-save" onclick="saveRename()">Save</button>
      </div>
    </div>
  </div>

  <script>
    const API = '/v1/conversations';
    let currentId = null;
    let renameId = null;

    // Load conversations
    async function loadConversations() {
      const res = await fetch(`${API}?offset=0&limit=50`);
      const json = await res.json();
      const list = document.getElementById('conversationList');
      list.innerHTML = '';
      (json.data || []).forEach(conv => {
        const div = document.createElement('div');
        div.className = 'conversation-item' + (conv._id === currentId ? ' active' : '');
        div.innerHTML = `
          <div class="title">${conv.title}</div>
          <button class="edit-btn" onclick="event.stopPropagation();openRename('${conv._id}','${conv.title.replace(/'/g, "\\'")}')">&#9998;</button>
        `;
        div.onclick = () => selectConversation(conv._id, conv.title);
        list.appendChild(div);
      });
    }

    // Create new conversation
    async function createConversation() {
      const title = 'New Chat ' + new Date().toLocaleTimeString();
      const res = await fetch(API, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ title })
      });
      const json = await res.json();
      if (json.success) {
        await loadConversations();
        selectConversation(json.data._id, json.data.title);
      }
    }

    // Select conversation & load messages
    async function selectConversation(id, title) {
      currentId = id;
      document.getElementById('chatHeader').textContent = title;
      document.getElementById('messageInput').focus();
      await loadConversations();
      // Note: we don't have a GET messages endpoint yet, so we clear
      document.getElementById('messages').innerHTML = '';
    }

    // Send message
    async function sendMessage() {
      if (!currentId) return alert('Please select or create a conversation first');
      const input = document.getElementById('messageInput');
      const content = input.value.trim();
      if (!content) return;

      input.value = '';
      const btn = document.getElementById('sendBtn');
      btn.disabled = true;

      // Show user message immediately
      appendMessage('user', content);

      const res = await fetch(`${API}/${currentId}/messages`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ content })
      });
      const json = await res.json();
      btn.disabled = false;

      if (json.success) {
        appendMessage('assistant', json.data.aiMessage.content);
      } else {
        appendMessage('assistant', 'Error: ' + json.error);
      }
      input.focus();
    }

    function appendMessage(role, content) {
      const div = document.createElement('div');
      div.className = 'message ' + role;
      div.textContent = content;
      const container = document.getElementById('messages');
      container.appendChild(div);
      container.scrollTop = container.scrollHeight;
    }

    // Rename
    function openRename(id, title) {
      renameId = id;
      document.getElementById('renameInput').value = title;
      document.getElementById('renameModal').classList.add('show');
      document.getElementById('renameInput').focus();
    }
    function closeRename() {
      document.getElementById('renameModal').classList.remove('show');
      renameId = null;
    }
    async function saveRename() {
      const title = document.getElementById('renameInput').value.trim();
      if (!title) return;
      await fetch(`${API}/${renameId}`, {
        method: 'PATCH',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ title })
      });
      closeRename();
      await loadConversations();
      if (renameId === currentId) {
        document.getElementById('chatHeader').textContent = title;
      }
    }

    // Init
    loadConversations();
  </script>
</body>
</html>
